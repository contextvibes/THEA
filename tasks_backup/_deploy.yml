# tasks/_deploy.yml
# This file defines the helper task for deploying the application.
# It orchestrates the process by calling the comprehensive deploy.sh script.

version: '3'

tasks:
  deploy:
    desc: "(Helper) Runs the deployment script."
    internal: true
    silent: true
    env:
      # This block explicitly exports all the necessary variables from the
      # Taskfile's context into the environment of the shell script. This
      # is the crucial fix.
      ASSETS_PROJECT_ID:      "{{.ASSETS_PROJECT_ID}}"
      ASSETS_GCP_REGION:      "{{.ASSETS_GCP_REGION}}"
      ARTIFACT_REGISTRY_NAME: "{{.ARTIFACT_REGISTRY_NAME}}"
      ARTIFACT_REGISTRY_REPO: "{{.ARTIFACT_REGISTRY_REPO}}"
      COMPUTE_PROJECT_ID:     "{{.COMPUTE_PROJECT_ID}}"
      CONTAINER_NAME:         "{{.CONTAINER_NAME}}"
      GCS_BUCKET_NAME:        "{{.GCS_BUCKET_NAME}}"
      LOG_LEVEL:              "{{.LOG_LEVEL}}"
      TARGET_PRINCIPAL_SA:    "{{.TARGET_PRINCIPAL_SA}}"
      TARGET_USER_EMAILS:     "{{.TARGET_USER_EMAILS}}"
    cmds:
      # The script will now correctly inherit the environment variables defined above.
      - ./scripts/deploy.sh